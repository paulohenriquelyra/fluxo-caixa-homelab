apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: monitoring
data:
  # Dashboards serão importados via UI do Grafana
  # Ou você pode adicionar arquivos JSON aqui
  
  # Exemplo de dashboard simples
  fluxo-caixa-overview.json: |
    {
      "dashboard": {
        "title": "Fluxo de Caixa - Overview",
        "tags": ["fluxo-caixa", "application"],
        "timezone": "browser",
        "schemaVersion": 38,
        "version": 1,
        "refresh": "30s",
        "panels": [
          {
            "id": 1,
            "gridPos": {"h": 6, "w": 8, "x": 0, "y": 0},
            "type": "stat",
            "title": "Total de Requisições HTTP",
            "targets": [{
              "expr": "sum(rate(http_requests_total[5m]))",
              "refId": "A"
            }],
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"]
              }
            },
            "fieldConfig": {
              "defaults": {
                "unit": "reqps",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 10},
                    {"color": "red", "value": 50}
                  ]
                }
              }
            }
          },
          {
            "id": 2,
            "gridPos": {"h": 6, "w": 8, "x": 8, "y": 0},
            "type": "stat",
            "title": "Latência Média (p95)",
            "targets": [{
              "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
              "refId": "A"
            }],
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"]
              }
            },
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 0.5},
                    {"color": "red", "value": 1}
                  ]
                }
              }
            }
          },
          {
            "id": 3,
            "gridPos": {"h": 6, "w": 8, "x": 16, "y": 0},
            "type": "stat",
            "title": "Conexões Ativas do Banco",
            "targets": [{
              "expr": "db_connections_active",
              "refId": "A"
            }],
            "options": {
              "reduceOptions": {
                "values": false,
                "calcs": ["lastNotNull"]
              }
            },
            "fieldConfig": {
              "defaults": {
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 10}
                  ]
                }
              }
            }
          },
          {
            "id": 4,
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
            "type": "timeseries",
            "title": "Requisições HTTP por Segundo",
            "targets": [{
              "expr": "sum(rate(http_requests_total[1m])) by (method, route)",
              "legendFormat": "{{method}} {{route}}",
              "refId": "A"
            }],
            "fieldConfig": {
              "defaults": {
                "custom": {
                  "drawStyle": "line",
                  "lineInterpolation": "smooth",
                  "fillOpacity": 10
                },
                "unit": "reqps"
              }
            }
          },
          {
            "id": 5,
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
            "type": "timeseries",
            "title": "Duração das Requisições HTTP",
            "targets": [{
              "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
              "legendFormat": "p95",
              "refId": "A"
            }, {
              "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",
              "legendFormat": "p50",
              "refId": "B"
            }],
            "fieldConfig": {
              "defaults": {
                "custom": {
                  "drawStyle": "line",
                  "lineInterpolation": "smooth",
                  "fillOpacity": 10
                },
                "unit": "s"
              }
            }
          },
          {
            "id": 6,
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 14},
            "type": "timeseries",
            "title": "Transações por Tipo",
            "targets": [{
              "expr": "sum(rate(fluxocaixa_transacoes_total[5m])) by (tipo)",
              "legendFormat": "{{tipo}}",
              "refId": "A"
            }],
            "fieldConfig": {
              "defaults": {
                "custom": {
                  "drawStyle": "bars",
                  "fillOpacity": 80
                },
                "unit": "short"
              }
            }
          },
          {
            "id": 7,
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 14},
            "type": "gauge",
            "title": "Saldo Atual",
            "targets": [{
              "expr": "fluxocaixa_saldo_atual",
              "refId": "A"
            }],
            "options": {
              "showThresholdLabels": false,
              "showThresholdMarkers": true
            },
            "fieldConfig": {
              "defaults": {
                "unit": "currencyBRL",
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 0},
                    {"color": "green", "value": 10000}
                  ]
                },
                "max": 100000,
                "min": -50000
              }
            }
          }
        ]
      }
    }

